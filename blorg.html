<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="120 hour epic">
  <title>blorg blorg blorg</title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
    q { quotes: "“" "”" "‘" "’"; }
  </style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="css/base.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
</head>
<body>
<div class="container-fluid">
<div class="row-fluid">
<div class="span12"><div class="top-nav"><a href="index.html">← index</a></div>
<header>
<h1 class="title">blorg blorg blorg</h1>
<h2 class="author">120 hour epic</h2>
<h3 class="date">sax marathon</h3>
</header>
<section class="level2" id="synopsis">
<h2>Synopsis</h2>
<p>In which we follow along an implementation of a blog engine.</p>
<ul>
<li>State.</li>
<li>Using libraries.</li>
<li>Organizing code.</li>
<li>The principle of <q>simple</q>.</li>
</ul>
</section>
<section class="level2" id="get-the-project">
<h2>Get the project</h2>
<pre><code>git clone https://github.com/iloveponies/blorg.git</code></pre>
<p>The project for this chapter contains multiple <em>tags</em> that identify different phases of the project as it was written. The chapter text will instruct you to check out a certain tag to see the code as it was at a specific point in time.</p>
<p>To begin with, check out the tag <code>initial</code> to see the first version of the code:</p>
<pre><code>git checkout initial</code></pre>
</section>
<section class="level2" id="the-idea">
<h2>The idea</h2>
<p>We want to write a blog engine, and not just any engine, but one written with Clojure. We also want to use ready-made libraries for writing web applications instead of inventing our own wheel (as satisfying it would be). Additionally, we want to keep the implementation as simple as possible.</p>
<section class="level3" id="exploratory-coding-or-why-we-dont-have-tests-yet">
<h3>Exploratory coding, or why we don’t have tests yet</h3>
<p>We don’t really know what we’re doing yet; we’re mostly gluing together existing libraries and defining a very simple model for blog posts. We decide to not write unit tests, and instead implement a <em>prototype</em> instead. We are prepared to throw away this code and reimplement a new version with tests. Alternatively, we might use the prototype itself as the production version and write tests for it after the fact.</p>
</section>
</section>
<section class="level2" id="initial-implementation">
<h2>Initial implementation</h2>
<p>Using the <code>initial</code> tag we can see our first initial implementation. First, we should take a look at the project definition, which tells us what libraries we are using:</p>
<pre class="sourceCode clojure"><code class="sourceCode clojure">(defproject blorg <span class="st">&quot;0.1.0-SNAPSHOT&quot;</span>
  <span class="kw">:dependencies</span> [[org.clojure/clojure <span class="st">&quot;1.4.0&quot;</span>]
                 [noir <span class="st">&quot;1.3.0-beta7&quot;</span>]])</code></pre>
<p>This definition tells us that blorg requires Clojure version 1.4.0 and the <a href="http://webnoir.org">noir</a> library version 1.3.0-beta7. TODO: why beta</p>
<section class="level3" id="the-first-page">
<h3>The first page</h3>
<p>Our initial implementation resides in one file, <code>src/blorg/core.clj</code>. It contains very little code, which we will now go over.</p>
<p>First, we start with a regular namespace declaration, which contains our <code>use</code> and <code>require</code> declarations:</p>
<pre class="sourceCode clojure"><code class="sourceCode clojure">(<span class="kw">ns</span> blorg.core
  (<span class="kw">:use</span> noir.core)
  (<span class="kw">:require</span> [noir.server <span class="kw">:as</span> server]
            [hiccup.page <span class="kw">:as</span> page]))</code></pre>
<p>We use <code>noir.core</code>, which imports the function names defined in that namespace into our own namespace. This means we can refer to functions in <code>noir.core</code> with just their names, like <code>defpage</code>.</p>
<p><code>require</code> loads just the namespace, which allows us to refer to functions defined in <code>noir.server</code> with <code>server/function</code>.</p>
<p>Next, we define some blog posts to display on the page:</p>
<pre class="sourceCode clojure"><code class="sourceCode clojure">(<span class="kw">def</span><span class="fu"> *posts* </span>[{<span class="kw">:title</span> <span class="st">&quot;foo&quot;</span> <span class="kw">:content</span> <span class="st">&quot;bar&quot;</span>}
              {<span class="kw">:title</span> <span class="st">&quot;quux&quot;</span> <span class="kw">:content</span> <span class="st">&quot;ref ref&quot;</span>}])</code></pre>
<p>At this point, we have decided to represent blog posts as maps with a title and the content of the blog post. Because using maps in Clojure is so simple this representation works well without introducing almost any boilerplate.</p>
<p>Satisfied that we can now represent blog posts, we define our web page:</p>
<pre class="sourceCode clojure"><code class="sourceCode clojure">(defpage <span class="st">&quot;/&quot;</span> []
  (page/html5
   (<span class="kw">for</span> [post *posts*]
     [<span class="kw">:section</span>
      [<span class="kw">:h2</span> (<span class="kw">:title</span> post)]
      [<span class="kw">:p</span> (<span class="kw">:content</span> post)]])))</code></pre>
<p>We use noir’s <code>defpage</code> to define a page located at the URL <code>/</code>. It contains a HTML 5 page that lists all the blog posts in their own <code>&lt;section&gt;</code> tags. We use <a href="https://github.com/weavejester/hiccup">Hiccup</a> to write HTML as Clojure vectors; the <code>page/html5</code> function will turn the vectors into HTML strings that are returned to the browser.</p>
<p>To test our page, we can open a REPL inside our project:</p>
<pre class="sourceCode clojure"><code class="sourceCode clojure">blorg$ lein <span class="kw">repl</span>
user=&gt; (<span class="kw">use</span> &#39;blorg.core)
nilWarning: *posts* <span class="kw">not</span> declared dynamic <span class="kw">and</span> thus <span class="kw">is</span> <span class="kw">not</span> dynamically
rebindable, but its <span class="kw">name</span> suggests otherwise. Please either indicate
^<span class="kw">:dynamic</span> *posts* <span class="kw">or</span> change the <span class="kw">name</span>. (blorg/core.clj<span class="kw">:6)</span>
user=&gt; (-main)
<span class="kw">&gt;</span> blorg blog blorg
Starting server...
<span class="dv">2012-05-23</span> <span class="dv">15</span><span class="kw">:22:07.579:INFO:oejs.Server:jetty-7.6.1.v20120215</span>
Server started on port [<span class="dv">8080</span>].
You can view the site at http<span class="kw">://localhost:8080</span>
#&lt;Server org.eclipse.jetty.server.Server<span class="kw">@c351f6d&gt;</span></code></pre>
<p>We first <code>(use 'blorg.core)</code> to load our file. This warns that the name <code>*posts*</code> uses a deprecated style for dynamic variables, which I used accidentally. You can ignore this; we will change it in the next code iteration.</p>
<p>Once our files is loaded, we call the <code>-main</code> function to run our server. Opening <code>http://localhost:8080</code> in a browser at this point should show a page with the two initial blog posts <code>foo</code> and <code>quux</code>.</p>
</section>
</section>
<footer>
    <p>
        &copy; <a href="http://iloveponies.github.com">iloveponies</a>.

        <span style="float: right">
            <a href="mailto:ilmari.vacklin@gmail.com">questions?</a>
        </span>
    </p>
</footer>
</div>
</div>
</div>
</body>
</html>
